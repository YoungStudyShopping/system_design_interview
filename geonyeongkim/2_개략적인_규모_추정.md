# 개략적인 규모 추정

시스템 설계 면접을 볼 때 `시스템 용량` 혹은 `성능 요구사항`을 개략적으로 추정해보라는 요구사항을 받게 된다.

규모추정을 해내기 위해 2의 제곱수나 응답지연 값 그리고 가용성에 관계된 수치들을 잘 이해하고 있어야 한다.

## 1. 2의 제곱수

데이터 볼륨을 측정하기 위해서는 2의 제곱수로 어떻게 표현되는지를 알아야 한다.

2의 x 제곱 | 근사치 | 이름 | 축약형
-- | -- | -- | --
10 | 1천 | 1킬로바이트 | 1KB
20 | 1백만 | 1메가바이트 | 1MB
30 | 10억 | 1기가바이트 | 1GB
40 | 1조 | 1테라바이트 | 1TB
50 | 1000조 | 1페타바이트 | 1PB

1byte는 8bit로 ASCII 문자하나가 1byte라는것을 기억하자.
> 한글은 한글자에 2byte.

## 2. 모든 프로그래머가 알아야 하는 응답지연 값

아래 그림은 통상적인 컴퓨터 연산 수행 시간이다.

<img width="777" alt="image" src="https://user-images.githubusercontent.com/31622350/159693670-f451f62c-f041-43fb-ab88-815e03f502dd.png">

위 그림을 요약하면 다음과 같다.

1. 메모리는 빠르지만 디스크는 아직도 느리다.
2. 디스크 탐색은 가능한 피해야 한다.
3. 단순한 압축 알고리즘은 빠르다.
4. 데이터를 인터넷으로 전송하기 전에 가능하면 압축하라.
5. 데이터센터는 보통 여러 지역에 분산되어 있고, 센터들 간에 데이터를 주고받는데는 시간이 걸린다.

## 3. 가용성에 관계된 수치들

고가용성이란?

- 시스템이 오랜시간동안 지속적으로 중단 없이 운영될 수 있는 능력을 지칭하는 용어.

고가용성은 일반적으로 퍼센트로 표현을 한다.

SLA(= Service Level Agreement) 는 서비스 사업자가 보편적으로 사용하는 용어로 서비스 가용시간이 공식적으로 기술되어 있다.

관습적으로 숫자 9를 사용하여 표시한다.

| 가용률 | 하루당 장애시간 | 주당 장애시간 | 개월당 장애시간 | 연간 장애시간 |
| -- | -- | -- | -- | -- |
| 99% | 14.40분 | 1.68시간 | 7.31시간 | 3.65일 |
| 99.9% | 1.44분 | 10.08분 | 43.83분 | 8.77시간 |
| 99.99% | 8.64초 | 1.01분 | 4.38분 | 52.60분 |
| 99.999% | 864.00 밀리초 | 6.05초 | 26.30초 | 5.26분 |
| 99.9999% | 86.40 밀리초 | 604.80밀리초 | 2.63초 | 31.56초 |

## 4. 예제: 트위터 QPS와 저장소 요구량 추정

### 가정

- 월간 활성 사용자: 3억명
- 50% 사용자가 매일 사용.
- 평균적으로 각 사용자는 매일 2건의 트윗을 올린다고 가정
- 미디어를 포함하는 트윗은 10% 정도
- 데이터는 5년간 보관

### 추정

**QPS(= Query Per Second) 추정치**

- 일간 활성 사용자 = 3억 * 50% = 1.5억
- QPS = 1.5억 * 2 트윗 / 24시간 / 3600초 = 약 3500
- 최대 QPS = 2 * QPS = 약 7000

**저장소 요구량**

- 평균 트윗 크기
  - tweet_id: 64byte
  - 텍스트: 140 byte
  - 미디어: 1MB
- 미디어 저장소 요구량: 1.5억 * 2 * 10% * 1MB = 30TB/일
- 5년간 미디어를 보관하기 위한 저장소 요구량: 30TB * 365 * 5 = 약 55PB

## 5. 팁

개략적인 규모 추정과 관계된 면접에서 가장 중요한 것은 문제를 풀어 나가는 절차다.

- 근사치를 활용한 계산
- 가정한 내용 기록
- 추정 시 단위 필수로 적기:  5KB or 5MB
- 많이 출제되는 개략적 규모 추정 문제는 QPS, 최대 QPS, 저장소 요구량, 캐시 요구량, 서버 수 이다.
